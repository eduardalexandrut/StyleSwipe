<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
    <link href="../style/style.css" rel="stylesheet">
</head>
<body>
    <!--Header-->    
        <header>
            <h2>StyleSwipe</h2>
            <a class="" href="login.html">Log Out</a>
        </header>
                <nav>
                    <ul>
                        <li>
                            <i class="bi-house"></i>
                            <a href="home.html">Home</a>
                        </li>
                        <li>
                            <i class="bi-search"></i>
                            <a href="#">Search</a>
                        </li>
                        <li>
                            <i data-name="active" class="bi-plus-circle"></i>
                            <a data-name="active" href="create.html">New Outfit</a>
                        </li>
                        <li>
                            <i class="bi-bell"></i>
                            <a data-bs-toggle="modal" data-bs-target="#notifyModal" href="#">Notifications</a>
                        </li>
                        <li>
                            <i class="bi-person"></i>
                            <a href="profile.html">Profile</a>
                        </li>
                    </ul>
                </nav>

                <main id="createMain">
                    <h1>New Outfit</h1>
                    <!--Image Picker-->
                    <section>
                        <input type="file" accept="image/*" class="d-none" id="selectedFile" onchange="previewImg()"/>
                        <input type="button" value="Select Photo +"  onclick="document.getElementById('selectedFile').click();" />
                    </section>
                    <!--Items Table-->
                    <h3>Items</h3>
                    <div class="container-fluid table-responsive">
                        <table class="table table-striped table-hover">
                            <tr>
                                <th scope="col">Name</th>
                                <th scope="col">Brand</th>
                                <th scope="col">Link</th>
                                <th scope="col">Size</th>
                                <th scope="col">Price</th>
                                <th scope="col"></th>
                            </tr>
                            <tr>
                                <td>Lorem</td>
                                <td>Lorem</td>
                                <td>Lorem</td>
                                <td>Lorem</td>
                                <td>Lorem</td>
                                <td><i class="bi-trash"></i></td>
                            </tr>
                        </table>
                    </div>
                </main><aside id="createAside">
                    <section>
                        <img src="../img/outfit.jpeg" alt=""/>
                        <ul>
                            <li><h4>@username</h4></li>
                            <li><p id="dateTime"></p></li>
                        </ul> 
                    </section>
                    <form action="#" method="post" >
                        <textarea placeholder="Add a description..." maxlength="250"></textarea>
                        <input  type="submit" value="Add Post"/>
                        <input  type="button" value="Discard"/>
                    </form>
                </aside>
                <!--Add Item Modal-->
                <div class="modal fade" id="addItemModal">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-body">
                                <h3>Component Info</h3>
                                <div class="form-floating mb-3">
                                    <input class="form-control" id="itemName" type="text"  name="link" placeholder="Name"/>
                                    <label for="itemName">Name</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input class="form-control" id="itemBrand" type="text"  name="link" placeholder="Brand"/>
                                    <label for="itemBrand">Brand</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input class="form-control" id="itemLink" type="text"  name="link" placeholder="Link"/>
                                    <label for="itemLink">Link</label>
                                </div>
                                <div class="row">
                                    <div class="form-floating mb-3 col-6">
                                        <input class="form-control" id="itemPrice" type="text"  name="link" placeholder="Price"/>
                                        <label for="itemPrice">Price</label>
                                    </div>
                                    <div class="form-floating mb-3 col-6">
                                        <input class="form-control" id="itemSize" type="text" name="link" placeholder="Size"/>
                                        <label for="itemSize">Size</label>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <input id="addPinBtn" type="button" data-bs-dismiss="modal" onclick="addRow()"  value="Add"/>
                                    <input type="button" data-bs-dismiss="modal" value="Discard">
                                </div>
                            </div>
                        </div>
                    </div>
                 </div>

                 <!--Notifications Modal-->
                <div class="modal fade" id="notifyModal">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class=" modal-content">
                            <div class="modal-header">
                                <h2>Notifications</h2>
                                <button data-bs-dismiss="modal">
                                    <i class="bi-x-circle"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <!--New Notification element.-->
                                <div class="notification">
                                    <img alt="User Profile Pic" src="../img/outfit.jpeg" />
                                    <span class="notify-badge badge rounded-pill bg-primary">New</span>
                                    <p><span class="notify-user"><a href="profile.html">@username</a></span> <a class="notify-liked" href="#">Liked</a> your post. <span class="notify-time">2h ago</span></p>
                                </div>

                                <!--Notification element.-->
                                <div class="notification">
                                    <img alt="User Profile Pic" src="../img/outfit.jpeg" />
                                    <p><span class="notify-user"><a href="profile.html">@username</a></span> <a class="notify-stared" href="#">Starred</a> your post. <span class="notify-time">2h ago</span></p>
                                </div>

                                <!--Notification element.-->
                                <div class="notification">
                                    <img alt="User Profile Pic" src="../img/outfit.jpeg" />
                                    <p><span class="notify-user"><a href="profile.html">@username</a></span> <a class="notify-commented" href="#">Commented</a> your post. <span class="notify-time">2h ago</span></p>
                                </div>
                                <!--New Notification element.-->
                                <div class="notification">
                                    <img alt="User Profile Pic" src="../img/outfit.jpeg" />
                                    <span class="notify-badge badge rounded-pill bg-primary">New</span>
                                    <p><span class="notify-user"><a href="profile.html">@username</a></span> <a class="notify-liked" href="#">Liked</a> your post. <span class="notify-time">2h ago</span></p>
                                </div>

                                <!--Notification element.-->
                                <div class="notification">
                                    <img alt="User Profile Pic" src="../img/outfit.jpeg" />
                                    <p><span class="notify-user"><a href="profile.html">@username</a></span> <a class="notify-stared" href="#">Starred</a> your post. <span class="notify-time">2h ago</span></p>
                                </div>

                                <!--Notification element.-->
                                <div class="notification">
                                    <img alt="User Profile Pic" src="../img/outfit.jpeg" />
                                    <p><span class="notify-user"><a href="profile.html">@username</a></span> <a class="notify-commented" href="#">Commented</a> your post. <span class="notify-time">2h ago</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
    <script>
        class Pin {
            x;
            y;
            name;
            brand;
            link;
            price;
            size;
        
            constructor(x, y) {
                this.x = x;
                this.y = y;
            }

            setName(name) {
                this.name = name;
            }
            setBrand(brand) {
                this.brand = brand;
            }
            setLink(link) {
                this.link = link;
            }
            setPrice(price) {
                this.price = price;
            }
            setSize(size) {
                this.size = size;
            }
        };
        const imgInput = document.getElementById('selectedFile');
        const image = document.createElement('img');
        const pins = [];
        const canvas = document.createElement('canvas');
        let ctx = canvas.getContext("2d");

        /*Event listener to draw the selected image on the canavs element, once it is loaded.
        image.addEventListener("load",()=> {ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.drawImage(image, 0,0, canvas.width, canvas.height); ;
        document.querySelector("#createMain section:first-of-type").style = "border: none;";},false);*/
        canvas.addEventListener("click", (e)=>addCircle(e.clientX, e.clientY), false);
        //canvas.style = "width:100%; height:500px; border-radius:30px;";
        canvas.setAttribute("data-bs-toggle","modal");
        canvas.setAttribute("data-bs-target","#addItemModal");
        

        
        /*Function to create a displayable image selected by the user.*/
        function previewImg() {
            let [file] = imgInput.files;
            if (file) {
                image.src = URL.createObjectURL(file);
                document.querySelector("#createMain section:first-of-type").style = "display: grid; grid-template-row: 500px;grid-template-column: 100%";
                document.querySelector("main#createMain > section").appendChild(image);
                document.querySelector("main#createMain > section").appendChild(canvas);
                document.querySelector("main#createMain > section input[type='button']").style="display:none;"
            }
        }

       
        /*Function to create and draw the pins on the selected image.*/
        function addCircle(x, y) {
            ctx.beginPath();
            ctx.arc(x, y-100, 5, 0 , 2*Math.PI);
            ctx.strokeStyle="red";
            ctx.fillStyle="blue";
            ctx.stroke();
            ctx.fill();
            let pin = new Pin(x,y);
            pins.push(pin);
        }
        
        /**Function to add a row within the table everytime a new pin is added.*/
        function addRow() {
            //Get the last pin and set its fields
            let pin = pins[pins.length - 1];
            pin.setName(document.getElementById("itemName").value);
            pin.setBrand(document.getElementById("itemBrand").value);
            pin.setLink(document.getElementById("itemLink").value);
            pin.setSize(document.getElementById("itemSize").value);
            pin.setPrice(document.getElementById("itemPrice").value);

            //Add row and create table datas
            let newRow = document.createElement('tr');
            let rName = document.createElement('td');
            rName.innerText = pin.name;
            let rBrand = document.createElement('td');
            rBrand.innerText = pin.brand;
            let rLink = document.createElement('td');
            rLink.innerText = pin.link;
            let rPrice = document.createElement('td');
            rPrice.innerText = pin.price;
            let rSize = document.createElement('td');
            rSize.innerText = pin.size;
            let rTrash = document.createElement('td');
            let trashIcon = document.createElement('i');
            trashIcon.setAttribute("class", "bi-trash");
            /*Add event listener to remove a row and a pin when the trash icon gets clicked*/
            trashIcon.addEventListener("click",(e)=>{
                document.querySelector(".table tbody").removeChild(newRow);
                //pins.(pin);
                /*Redaw canvas*/
            }, false);
            rTrash.appendChild(trashIcon);
            newRow.appendChild(rName);
            newRow.appendChild(rBrand);
            newRow.appendChild(rLink);
            newRow.appendChild(rPrice);
            newRow.appendChild(rSize);
            newRow.appendChild(rTrash);
            document.querySelector(".table tbody").appendChild(newRow);
        }
        /*Code to inject current date in #dateTime*/
        let now = new Date();
        let date = now.toLocaleString();
        document.getElementById("dateTime").innerHTML = date;
        </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</body>
</html>
<!--

    .Create:
    - Add more margin between elements.---DONE
    - Add trash icons to the table.--DONE
    - Add canvas instead of section--DONE
    - Add js code to add pins--BUG
    - Add modal for pins--DONE
    - Add js code to add rows in the table--DONE
    - Add js to delete pins and tables--1/2
    - Scale the image canvas in a better way
    - Add php tp create post instance

-->